<#include "_inc/_layout.html"/>
<#macro script>

//获取验证码正确性
function getVerifyCode(){
	var telephone = $("#mobile").val();
	if(telephone){
		$.get("${CPATH}/verifyCode/getVerifyCode?telephone="+telephone, function(data){
			if(data.errorCode > 0){
				layer.msg('验证码获取失败：'+data.message);
			}
		});
	}else{
		layer.msg('请输入手机号码');
	}
}
 
 //获取验证码正确性
function checkVerifyCode(){
	var telephone = $("#mobile").val();
	var verifyCode = $("#verifyCode").val();
	$.ajax({ 
        type: "post", 
        url: "${CPATH}/verifyCode/checkVerifyCode?telephone="+telephone+"&verifyCode="+verifyCode, 
        cache:false, 
        async:false, 
        success: function(data){ 
             if(data.errorCode == 0){
				return true;
			}else{
				layer.msg('验证码错误');
				return false;
			}        
        } 
 	});
 }

function doSubmit(){
	var realname = $("#realname").val();
	var telephone = $("#mobile").val();
	var verifyCode = $("#verifyCode").val();
	if(typeof realname == "undefined" || realname == null || realname == ""){
		layer.msg('请输入真实姓名');
		return;
	}
	if(typeof telephone == "undefined" || telephone == null || telephone == ""){
		layer.msg('请输入手机号码');
		return;
	}
	if(typeof verifyCode == "undefined" || verifyCode == null || verifyCode == ""){
		layer.msg('请输入验证码');
		return;
	}
	
	var flag = checkVerifyCode();
	if(flag){
		$("#form").ajaxSubmit({
		type : "post", 
		dataType : "json", 
		success : function(data) {
			if(data.errorCode == 0){
				window.location.href="${CPATH}/user/center";
			}else{
				layer.msg('用户信息更新失败:'+data.message);
			}
		},
		error : function() {
			layer.msg('用户信息更新失败');
		}
	  });
	}
 }
 
</#macro>
<@layout>
<section>
	<header class="major">
        <h4>个人信息</h4>
    </header>
    
	<form action="${CPATH}/user/doSaveUserSetting" method="post" id="form">
	<input type="hidden" name="user.id" value="${(user.id)!}">
	<div class="col-xs-12 ">
		<div class="row">
			<ul class="list-unstyled">
				<li class="jp-set-pad">
					<div class="col-sm-9">
						<div class="col-sm-3">真实姓名</div>
						<div class="col-sm-6">
							<input class="form-control input-md" type="text" id="realname" name="user.realname" value="${(user.realname)!}" >
						</div>
					</div>
				</li>
				
				<li class="jp-set-pad">
					<div class="col-sm-9">
						<div class="col-sm-3">手机号码</div>
						<div class="col-sm-6">
							<input class="form-control input-md" type="text" id="mobile" name="user.mobile" value="${(user.mobile)!}" >
							<button type="button" onclick="getVerifyCode()" class="btn btn-primary">获取验证码</button>
						</div>
					</div>
				</li>
				
				<li class="jp-set-pad">
					<div class="col-sm-9">
						<div class="col-sm-3">验证码</div>
						<div class="col-sm-6">
							<input class="form-control input-md" type="text" id="verifyCode" name="verifyCode" >
						</div>
					</div>
				</li>
			</ul>
		</div>
		
	</div>
	
	<div class="row">
		<div class="col-xs-12">
			<button type="button" onclick="doSubmit()" class="btn btn-primary">保存更改</button>
		</div>
	</div>
	
	
	</form>
	<#include "_inc/_user_bottom_bar.html"/>
</section>
</@layout>